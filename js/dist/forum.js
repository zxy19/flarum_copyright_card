(()=>{var t={n:r=>{var o=r&&r.__esModule?()=>r.default:()=>r;return t.d(o,{a:o}),o},d:(r,o)=>{for(var a in o)t.o(o,a)&&!t.o(r,a)&&Object.defineProperty(r,a,{enumerable:!0,get:o[a]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r)};(()=>{"use strict";const r=flarum.core.compat["common/app"];t.n(r)().initializers.add("xypp/flarum-copyright-card",(function(){console.log("[xypp/flarum-copyright-card] Hello, forum and admin!")}));const o=flarum.core.compat["forum/app"];var a=t.n(o);const n=flarum.core.compat["forum/components/CommentPost"];var i=t.n(n);const e=flarum.core.compat["common/extend"];function s(t,r){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},s(t,r)}function c(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,s(t,r)}const p=flarum.core.compat["common/Component"];var u=t.n(p);const l=flarum.core.compat["common/utils/classList"];var d=t.n(l);const h=flarum.core.compat["common/utils/ItemList"];var y=t.n(h),f=function(t){function r(){return t.apply(this,arguments)||this}c(r,t);var o=r.prototype;return o.view=function(t){return m("div",{className:d()("copyright-piece",this.attrs.data.type)},this.attrs.first?"":m("div",{className:"copyright-piece-type"},a().translator.trans("xypp-copyright-card.forum.type."+this.attrs.data.type)),m("div",{className:"copyright-piece-content"},this.content().toArray()))},o.content=function(){var t=new(y());return this.attrs.data.author&&t.add("author",m("div",null,a().translator.trans("xypp-copyright-card.forum.copyright.author",{author:this.attrs.data.author}))),this.attrs.data.title&&t.add("title",m("div",null,a().translator.trans("xypp-copyright-card.forum.copyright.title",{title:this.attrs.data.title}))),this.attrs.data.url&&t.add("url",m("div",null,a().translator.trans("xypp-copyright-card.forum.copyright.url",{url:this.attrs.data.url,a:m("a",{href:this.attrs.data.url,target:"_blank"})}))),this.attrs.data.license&&t.add("license",m("div",null,a().translator.trans("xypp-copyright-card.forum.copyright.license",{license:this.attrs.data.license}))),this.attrs.data.other&&t.add("other",m("div",null,this.attrs.data.other)),t},r}(u()),v=function(t){function r(){return t.apply(this,arguments)||this}c(r,t);var o=r.prototype;return o.view=function(t){var r,o;return m("div",{className:d()("copyright-card",(null==(r=this.attrs.data)?void 0:r.current)||"none")},m("div",{className:"copyright-current-type"},m("i",{class:"fas fa-copyright"}),a().translator.trans("xypp-copyright-card.forum.current."+((null==(o=this.attrs.data)?void 0:o.current)||"none"))),m("div",null,this.pieces().toArray()))},o.pieces=function(){var t=this,r=new(y());return this.attrs.data?(this.attrs.data.all.forEach((function(o,a){var n;r.add(a+"",m(f,{data:o,first:0==a&&o.type==(null==(n=t.attrs.data)?void 0:n.current)}))})),r):r},r}(u());const g=flarum.core.compat["forum/components/DiscussionListItem"];var x=t.n(g);const b=flarum.core.compat["forum/utils/DiscussionControls"];var N=t.n(b);const B=flarum.core.compat["common/components/Button"];var w=t.n(B);const k=flarum.core.compat["common/components/Modal"];var O=t.n(k);const C=flarum.core.compat["common/utils/Stream"];var M=t.n(C),A=function(t){return t.url="url",t.title="title",t.author="author",t.license="license",t.other="other",t}({}),I=function(t){return t.original="original",t.translation="translation",t.transport="transport",t.modify="modify",t.revive="revive",t.own="own",t}({});const P=flarum.core.compat["common/utils/extractText"];var _=t.n(P);const F=flarum.core.compat["common/components/Select"];var j=t.n(F),D=function(t){function r(){for(var r,o=arguments.length,a=new Array(o),n=0;n<o;n++)a[n]=arguments[n];return(r=t.call.apply(t,[this].concat(a))||this).type=void 0,r.values={},r.typeOpt={},r}c(r,t);var o=r.prototype;return o.oninit=function(r){for(var o in t.prototype.oninit.call(this,r),this.type=M()(this.attrs.value.type||I.original),A)this.values[o]=M()(this.attrs.value[o]||"");for(var n in I)this.typeOpt[n]=_()(a().translator.trans("xypp-copyright-card.forum.type."+n))},o.className=function(){return"Modal Modal--small"},o.title=function(){return a().translator.trans("xypp-copyright-card.forum.piece.piece")},o.content=function(){return m("div",{className:"Modal-body"},m("div",{className:"Form"},this.fields().toArray(),m("div",{className:"Form-group"},m(w(),{className:"Button Button--primary Button--block",onclick:this.onsubmit.bind(this)},a().translator.trans("xypp-copyright-card.forum.piece.submit")))))},o.fields=function(){var t=new(y());for(var r in t.add("type",m("div",{className:"Form-group"},m("label",{for:"xypp-copyright-type"},a().translator.trans("xypp-copyright-card.forum.piece.type")),m(j(),{id:"xypp-copyright-type",options:this.typeOpt,value:this.type(),onchange:this.type}))),A){var o=r;t.add(o,m("div",{className:"Form-group"},m("label",{for:"xypp-copyright-"+o},a().translator.trans("xypp-copyright-card.forum.piece."+o)),m("input",{id:"xypp-copyright-"+o,required:!0,className:"FormControl",type:"text",bidi:this.values[o]})))}return t},o.onsubmit=function(t){t.preventDefault();var r={type:this.type()};for(var o in A){var n=o;this.values[n]()&&(r[n]=this.values[n]())}this.attrs.onchange(r),a().modal.close()},r}(O()),L=function(t){function r(){for(var r,o=arguments.length,a=new Array(o),n=0;n<o;n++)a[n]=arguments[n];return(r=t.call.apply(t,[this].concat(a))||this).values=[],r.current=M()(I.original),r.typeOpt={},r}c(r,t);var o=r.prototype;return o.oninit=function(r){var o,n;for(var i in t.prototype.oninit.call(this,r),this.values=(null==(o=this.attrs.value)?void 0:o.all)||[],this.current((null==(n=this.attrs.value)?void 0:n.current)||I.original),I)this.typeOpt[i]=_()(a().translator.trans("xypp-copyright-card.forum.current."+i))},o.className=function(){return"Modal Modal--small"},o.title=function(){return a().translator.trans("xypp-copyright-card.forum.config.title")},o.content=function(){return m("div",{className:"Modal-body"},this.items().toArray(),m(w(),{className:"Button Button--primary Button--block",onclick:this.onsubmit.bind(this)},a().translator.trans("xypp-copyright-card.forum.config.submit")),m(w(),{className:"Button Button--block Button--danger",onclick:this.clear.bind(this)},a().translator.trans("xypp-copyright-card.forum.config.clear")))},o.items=function(){var t=this,r=new(y());return r.add("current",m("div",{className:"Form-group"},m("label",{for:"xypp-copyright-current"},a().translator.trans("xypp-copyright-card.forum.config.current")),m(j(),{id:"xypp-copyright-current",options:this.typeOpt,onchange:this.current,value:this.current()}))),this.values.forEach((function(o,a){return r.add("piece-"+a,t.piece(o,a))})),r.add("add",m(w(),{className:"Button Button--block",onclick:this.add.bind(this)},a().translator.trans("xypp-copyright-card.forum.config.add"))),r},o.piece=function(t,r){return m("div",{className:"config-piece"},m(f,{data:t}),m("div",null,m(w(),{className:"Button Button--block",onclick:this.remove(r)},a().translator.trans("xypp-copyright-card.forum.config.remove")),m(w(),{className:"Button Button--block",onclick:this.edit(r)},a().translator.trans("xypp-copyright-card.forum.config.edit"))))},o.onsubmit=function(t){t.preventDefault();var r={current:this.current(),all:this.values};this.attrs.onchange(r),a().modal.close()},o.clear=function(){this.attrs.onchange(null),a().modal.close()},o.remove=function(t){var r=this;return function(){r.values.splice(t,1),m.redraw()}.bind(this)},o.edit=function(t){var r=this;return function(){a().modal.show(D,{value:r.values[t],onchange:function(o){r.values[t]=o,m.redraw()}.bind(r)},!0)}.bind(this)},o.add=function(){this.values.push({type:I.original,author:"",license:"",title:"",url:""}),m.redraw()},r}(O());const z=flarum.core.compat["forum/components/DiscussionComposer"];var E=t.n(z);a().initializers.add("xypp/flarum-copyright-card",(function(){"bodyItems"in i().prototype?(0,e.extend)(i().prototype,"bodyItems",(function(t){var r=this.attrs.post.discussion(),o=!1;if(flarum.extensions["flarum-tags"]){var n=r.tags(),i=a().forum.attribute("xypp-copyright-card.force-tag")||[];o=!(!n||!n.find((function(t){return t&&i.includes(t.id()+"")})))}if(r&&this.attrs.post&&1==this.attrs.post.number()){var e=r.attribute("copyright");(e||o)&&t.add("copyright",v.component({data:e}),1e4)}})):(0,e.extend)(i().prototype,"content",(function(t){var r=this.attrs.post.discussion(),o=!1;if(flarum.extensions["flarum-tags"]){var n=r.tags(),i=a().forum.attribute("xypp-copyright-card.force-tag")||[];o=!(!n||!n.find((function(t){return t&&i.includes(t.id()+"")})))}if(r&&this.attrs.post&&1==this.attrs.post.number()){var e=r.attribute("copyright");(e||o)&&Array.from(t).find((function(t){return"Post-body"==t.attrs.className})).children.unshift(v.component({data:e}))}})),"mainItems"in x().prototype?(0,e.extend)(x().prototype,"mainItems",(function(t){var r=this.attrs.discussion.attribute("copyright");if(r){var o=t.get("title");t.add("title",m("div",{className:"copyright-title"},m("div",{className:d()("copyright-prefix",r.current)},a().translator.trans("xypp-copyright-card.forum.prefix."+r.current)),o),t.getPriority("title"))}})):(0,e.extend)(x().prototype,"mainView",(function(t){var r=this.attrs.discussion.attribute("copyright");if(r){var o=t.children[0];t.children[0]=m("div",{className:"copyright-title"},m("div",{className:d()("copyright-prefix",r.current)},a().translator.trans("xypp-copyright-card.forum.prefix."+r.current)),o)}})),(0,e.extend)(N(),"moderationControls",(function(t,r){r.attribute("xypp-copyright.edit")&&t.add("xypp-copyright",w().component({icon:"fas fa-copyright",className:"Button Button--link",onclick:function(){a().modal.show(L,{value:r.attribute("copyright"),onchange:function(t){r.save({copyright:t})}},!0)}},a().translator.trans("xypp-copyright-card.forum.select-copyright")))})),(0,e.extend)(E().prototype,"headerItems",(function(t){var r;this.composer.fields.tags&&this.composer.fields.tags.find((function(t){return t.attribute("xypp-copyright.edit")}))&&t.add("copyright",m("a",{className:"ComposerBody-copyright",onclick:(r=this,function(){a().modal.show(L,{value:r.composer.fields.copyright,onchange:function(t){t?r.composer.fields.copyright=t:delete r.composer.fields.copyright}},!0)})},m("span",{className:d()("CopyrightLabel",!this.composer.fields.copyright&&"none")},a().translator.trans("xypp-copyright-card.forum.select-copyright"))),1)})),(0,e.extend)(E().prototype,"data",(function(t){var r,o;null!=(r=this.composer)&&null!=(r=r.fields)&&r.copyright&&(t.copyright=null==(o=this.composer)||null==(o=o.fields)?void 0:o.copyright)}))}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map